THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=true;THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial();a.copy(this);a.color.copy(this.color);a.program=this.program;return a};THREE.CanvasRenderer=function(B){console.log("THREE.CanvasRenderer",THREE.REVISION);B=B||{};var t=this,y,C,n,a=new THREE.Projector(),i=B.canvas!==undefined?B.canvas:document.createElement("canvas"),w=i.width,am=i.height,X=Math.floor(w/2),F=Math.floor(am/2),c=0,b=0,ao=w,v=am,U=1,f=i.getContext("2d",{alpha:B.alpha===true}),D=new THREE.Color(0),ai=B.alpha===true?0:1,an=1,ak=0,u=null,aj=null,H=null,l=null,ah=null,K=[],W,V,S,s,r,e,d,av,at,h=new THREE.Color(),Q=new THREE.Color(),p=new THREE.Color(),ae=new THREE.Color(),E={},k,au,aq,af,ad,N,M,ax=new THREE.Box2(),q=new THREE.Box2(),x=new THREE.Box2(),ap=new THREE.Color(),z=new THREE.Color(),T=new THREE.Color(),m=new THREE.Vector3(),ay=new THREE.Vector3(),P=new THREE.Vector3(),J=new THREE.Matrix3();if(f.setLineDash===undefined){f.setLineDash=function(){}}this.domElement=i;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.getContext=function(){return f};this.getContextAttributes=function(){return f.getContextAttributes()};this.getPixelRatio=function(){return U};this.setPixelRatio=function(aA){if(aA!==undefined){U=aA}};this.setSize=function(aB,aA,aC){w=aB*U;am=aA*U;i.width=w;i.height=am;X=Math.floor(w/2);F=Math.floor(am/2);if(aC!==false){i.style.width=aB+"px";i.style.height=aA+"px"}ax.min.set(-X,-F);ax.max.set(X,F);q.min.set(-X,-F);q.max.set(X,F);an=1;ak=0;u=null;aj=null;H=null;l=null;ah=null;this.setViewport(0,0,aB,aA)};this.setViewport=function(aB,aD,aC,aA){c=aB*U;b=aD*U;ao=aC*U;v=aA*U};this.setScissor=function(){};this.setScissorTest=function(){};this.setClearColor=function(aA,aB){D.set(aA);ai=aB!==undefined?aB:1;q.min.set(-X,-F);q.max.set(X,F)};this.setClearColorHex=function(aA,aB){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(aA,aB)};this.getClearColor=function(){return D};this.getClearAlpha=function(){return ai};this.getMaxAnisotropy=function(){return 0};this.clear=function(){if(q.isEmpty()===false){q.intersect(ax);q.expandByScalar(2);q.min.x=q.min.x+X;q.min.y=-q.min.y+F;q.max.x=q.max.x+X;q.max.y=-q.max.y+F;if(ai<1){f.clearRect(q.min.x|0,q.max.y|0,(q.max.x-q.min.x)|0,(q.min.y-q.max.y)|0)}if(ai>0){A(1);aa(THREE.NormalBlending);Y("rgba("+Math.floor(D.r*255)+","+Math.floor(D.g*255)+","+Math.floor(D.b*255)+","+ai+")");f.fillRect(q.min.x|0,q.max.y|0,(q.max.x-q.min.x)|0,(q.min.y-q.max.y)|0)}q.makeEmpty()}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(aG,aE){if(aE.isCamera===undefined){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}var aB=aG.background;if(aB&&aB.isColor){A(1);aa(THREE.NormalBlending);Y(aB.getStyle());f.fillRect(0,0,w,am)}else{if(this.autoClear===true){this.clear()}}t.info.render.vertices=0;t.info.render.faces=0;f.setTransform(ao/w,0,0,-v/am,c,am-b);f.translate(X,F);y=a.projectScene(aG,aE,this.sortObjects,this.sortElements);C=y.elements;n=y.lights;J.getNormalMatrix(aE.matrixWorldInverse);ac();for(var aF=0,aD=C.length;aF<aD;aF++){var aA=C[aF];var aC=aA.material;if(aC===undefined||aC.opacity===0){continue}x.makeEmpty();if(aA instanceof THREE.RenderableSprite){W=aA;W.x*=X;W.y*=F;o(W,aA,aC)}else{if(aA instanceof THREE.RenderableLine){W=aA.v1;V=aA.v2;W.positionScreen.x*=X;W.positionScreen.y*=F;V.positionScreen.x*=X;V.positionScreen.y*=F;x.setFromPoints([W.positionScreen,V.positionScreen]);if(ax.intersectsBox(x)===true){ag(W,V,aA,aC)}}else{if(aA instanceof THREE.RenderableFace){W=aA.v1;V=aA.v2;S=aA.v3;if(W.positionScreen.z<-1||W.positionScreen.z>1){continue}if(V.positionScreen.z<-1||V.positionScreen.z>1){continue}if(S.positionScreen.z<-1||S.positionScreen.z>1){continue}W.positionScreen.x*=X;W.positionScreen.y*=F;V.positionScreen.x*=X;V.positionScreen.y*=F;S.positionScreen.x*=X;S.positionScreen.y*=F;if(aC.overdraw>0){Z(W.positionScreen,V.positionScreen,aC.overdraw);Z(V.positionScreen,S.positionScreen,aC.overdraw);Z(S.positionScreen,W.positionScreen,aC.overdraw)}x.setFromPoints([W.positionScreen,V.positionScreen,S.positionScreen]);if(ax.intersectsBox(x)===true){az(W,V,S,0,1,2,aA,aC)}}}}q.union(x)}f.setTransform(1,0,0,1,0,0)};function ac(){ap.setRGB(0,0,0);z.setRGB(0,0,0);T.setRGB(0,0,0);for(var aC=0,aD=n.length;aC<aD;aC++){var aB=n[aC];var aA=aB.color;if(aB.isAmbientLight){ap.add(aA)}else{if(aB.isDirectionalLight){z.add(aA)}else{if(aB.isPointLight){T.add(aA)}}}}}function g(aA,aH,aE){for(var aD=0,aG=n.length;aD<aG;aD++){var aC=n[aD];ae.copy(aC.color);if(aC.isDirectionalLight){var aB=m.setFromMatrixPosition(aC.matrixWorld).normalize();var aF=aH.dot(aB);if(aF<=0){continue}aF*=aC.intensity;aE.add(ae.multiplyScalar(aF))}else{if(aC.isPointLight){var aB=m.setFromMatrixPosition(aC.matrixWorld);var aF=aH.dot(m.subVectors(aB,aA).normalize());if(aF<=0){continue}aF*=aC.distance==0?1:1-Math.min(aA.distanceTo(aB)/aC.distance,1);if(aF==0){continue}aF*=aC.intensity;aE.add(ae.multiplyScalar(aF))}}}}function o(aM,aE,aF){A(aF.opacity);aa(aF.blending);var aO=aE.scale.x*X;var aN=aE.scale.y*F;var aI=Math.sqrt(aO*aO+aN*aN);x.min.set(aM.x-aI,aM.y-aI);x.max.set(aM.x+aI,aM.y+aI);if(aF.isSpriteMaterial){var aH=aF.map;if(aH!==null){var aG=E[aH.id];if(aG===undefined||aG.version!==aH.version){aG=I(aH);E[aH.id]=aG}if(aG.canvas!==undefined){Y(aG.canvas);var aL=aH.image;var aB=aL.width*aH.offset.x;var aA=aL.height*aH.offset.y;var aK=aL.width*aH.repeat.x;var aJ=aL.height*aH.repeat.y;var aD=aO/aK;var aC=aN/aJ;f.save();f.translate(aM.x,aM.y);if(aF.rotation!==0){f.rotate(aF.rotation)}f.translate(-aO/2,-aN/2);f.scale(aD,aC);f.translate(-aB,-aA);f.fillRect(aB,aA,aK,aJ);f.restore()}}else{Y(aF.color.getStyle());f.save();f.translate(aM.x,aM.y);if(aF.rotation!==0){f.rotate(aF.rotation)}f.scale(aO,-aN);f.fillRect(-0.5,-0.5,1,1);f.restore()}}else{if(aF.isSpriteCanvasMaterial){al(aF.color.getStyle());Y(aF.color.getStyle());f.save();f.translate(aM.x,aM.y);if(aF.rotation!==0){f.rotate(aF.rotation)}f.scale(aO,aN);aF.program(f);f.restore()}else{if(aF.isPointsMaterial){Y(aF.color.getStyle());f.save();f.translate(aM.x,aM.y);if(aF.rotation!==0){f.rotate(aF.rotation)}f.scale(aO*aF.size,-aN*aF.size);f.fillRect(-0.5,-0.5,1,1);f.restore()}}}}function ag(aH,aF,aD,aE){A(aE.opacity);aa(aE.blending);f.beginPath();f.moveTo(aH.positionScreen.x,aH.positionScreen.y);f.lineTo(aF.positionScreen.x,aF.positionScreen.y);if(aE.isLineBasicMaterial){G(aE.linewidth);R(aE.linecap);ar(aE.linejoin);if(aE.vertexColors!==THREE.VertexColors){al(aE.color.getStyle())}else{var aC=aD.vertexColors[0].getStyle();var aA=aD.vertexColors[1].getStyle();if(aC===aA){al(aC)}else{try{var aG=f.createLinearGradient(aH.positionScreen.x,aH.positionScreen.y,aF.positionScreen.x,aF.positionScreen.y);aG.addColorStop(0,aC);aG.addColorStop(1,aA)}catch(aB){aG=aC}al(aG)}}if(aE.isLineDashedMaterial){O([aE.dashSize,aE.gapSize])}f.stroke();x.expandByScalar(aE.linewidth*2);if(aE.isLineDashedMaterial){O([])}}}function az(aI,aH,aG,aD,aC,aB,aE,aF){t.info.render.vertices+=3;t.info.render.faces++;A(aF.opacity);aa(aF.blending);s=aI.positionScreen.x;r=aI.positionScreen.y;e=aH.positionScreen.x;d=aH.positionScreen.y;av=aG.positionScreen.x;at=aG.positionScreen.y;L(s,r,e,d,av,at);if((aF.isMeshLambertMaterial||aF.isMeshPhongMaterial||aF.isMeshStandardMaterial)&&aF.map===null){Q.copy(aF.color);p.copy(aF.emissive);if(aF.vertexColors===THREE.FaceColors){Q.multiply(aE.color)}h.copy(ap);ay.copy(aI.positionWorld).add(aH.positionWorld).add(aG.positionWorld).divideScalar(3);g(ay,aE.normalModel,h);h.multiply(Q).add(p);aF.wireframe===true?aw(h,aF.wireframeLinewidth,aF.wireframeLinecap,aF.wireframeLinejoin):j(h)}else{if(aF.isMeshBasicMaterial||aF.isMeshLambertMaterial||aF.isMeshPhongMaterial||aF.isMeshStandardMaterial){if(aF.map!==null){var aA=aF.map.mapping;if(aA===THREE.UVMapping){k=aE.uvs;ab(s,r,e,d,av,at,k[aD].x,k[aD].y,k[aC].x,k[aC].y,k[aB].x,k[aB].y,aF.map)}}else{if(aF.envMap!==null){if(aF.envMap.mapping===THREE.SphericalReflectionMapping){P.copy(aE.vertexNormalsModel[aD]).applyMatrix3(J);au=0.5*P.x+0.5;aq=0.5*P.y+0.5;P.copy(aE.vertexNormalsModel[aC]).applyMatrix3(J);af=0.5*P.x+0.5;ad=0.5*P.y+0.5;P.copy(aE.vertexNormalsModel[aB]).applyMatrix3(J);N=0.5*P.x+0.5;M=0.5*P.y+0.5;ab(s,r,e,d,av,at,au,aq,af,ad,N,M,aF.envMap)}}else{h.copy(aF.color);if(aF.vertexColors===THREE.FaceColors){h.multiply(aE.color)}aF.wireframe===true?aw(h,aF.wireframeLinewidth,aF.wireframeLinecap,aF.wireframeLinejoin):j(h)}}}else{if(aF.isMeshNormalMaterial){P.copy(aE.normalModel).applyMatrix3(J);h.setRGB(P.x,P.y,P.z).multiplyScalar(0.5).addScalar(0.5);aF.wireframe===true?aw(h,aF.wireframeLinewidth,aF.wireframeLinecap,aF.wireframeLinejoin):j(h)}else{h.setRGB(1,1,1);aF.wireframe===true?aw(h,aF.wireframeLinewidth,aF.wireframeLinecap,aF.wireframeLinejoin):j(h)}}}}function L(aD,aF,aB,aE,aA,aC){f.beginPath();f.moveTo(aD,aF);f.lineTo(aB,aE);f.lineTo(aA,aC);f.closePath()}function aw(aA,aD,aC,aB){G(aD);R(aC);ar(aB);al(aA.getStyle());f.stroke();x.expandByScalar(aD*2)}function j(aA){Y(aA.getStyle());f.fill()}function I(aI){if(aI.version===0||aI instanceof THREE.CompressedTexture||aI instanceof THREE.DataTexture){return{canvas:undefined,version:aI.version}}var aE=aI.image;if(aE.complete===false){return{canvas:undefined,version:0}}var aJ=aI.wrapS===THREE.RepeatWrapping||aI.wrapS===THREE.MirroredRepeatWrapping;var aG=aI.wrapT===THREE.RepeatWrapping||aI.wrapT===THREE.MirroredRepeatWrapping;var aF=aI.wrapS===THREE.MirroredRepeatWrapping;var aD=aI.wrapT===THREE.MirroredRepeatWrapping;var aC=document.createElement("canvas");aC.width=aE.width*(aF?2:1);aC.height=aE.height*(aD?2:1);var aB=aC.getContext("2d");aB.setTransform(1,0,0,-1,0,aE.height);aB.drawImage(aE,0,0);if(aF===true){aB.setTransform(-1,0,0,-1,aE.width,aE.height);aB.drawImage(aE,-aE.width,0)}if(aD===true){aB.setTransform(1,0,0,1,0,0);aB.drawImage(aE,0,aE.height)}if(aF===true&&aD===true){aB.setTransform(-1,0,0,1,aE.width,0);aB.drawImage(aE,-aE.width,aE.height)}var aA="no-repeat";if(aJ===true&&aG===true){aA="repeat"}else{if(aJ===true){aA="repeat-x"}else{if(aG===true){aA="repeat-y"}}}var aH=f.createPattern(aC,aA);if(aI.onUpdate){aI.onUpdate(aI)}return{canvas:aH,version:aI.version}}function ab(aS,aF,aP,aE,aM,aC,aO,aD,aL,aB,aK,aA,aH){var aN=E[aH.id];if(aN===undefined||aN.version!==aH.version){aN=I(aH);E[aH.id]=aN}if(aN.canvas!==undefined){Y(aN.canvas)}else{Y("rgba( 0, 0, 0, 1)");f.fill();return}var aZ,aY,aX,aW,aU,aR,aG,aV,aT=aH.offset.x/aH.repeat.x,aQ=aH.offset.y/aH.repeat.y,aJ=aH.image.width*aH.repeat.x,aI=aH.image.height*aH.repeat.y;aO=(aO+aT)*aJ;aD=(aD+aQ)*aI;aL=(aL+aT)*aJ;aB=(aB+aQ)*aI;aK=(aK+aT)*aJ;aA=(aA+aQ)*aI;aP-=aS;aE-=aF;aM-=aS;aC-=aF;aL-=aO;aB-=aD;aK-=aO;aA-=aD;aG=aL*aA-aK*aB;if(aG===0){return}aV=1/aG;aZ=(aA*aP-aB*aM)*aV;aY=(aA*aE-aB*aC)*aV;aX=(aL*aM-aK*aP)*aV;aW=(aL*aC-aK*aE)*aV;aU=aS-aZ*aO-aX*aD;aR=aF-aY*aO-aW*aD;f.save();f.transform(aZ,aY,aX,aW,aU,aR);f.fill();f.restore()}function Z(aG,aD,aF){var aA=aD.x-aG.x,aE=aD.y-aG.y,aB=aA*aA+aE*aE,aC;if(aB===0){return}aC=aF/Math.sqrt(aB);aA*=aC;aE*=aC;aD.x+=aA;aD.y+=aE;aG.x-=aA;aG.y-=aE}function A(aA){if(an!==aA){f.globalAlpha=aA;an=aA}}function aa(aA){if(ak!==aA){if(aA===THREE.NormalBlending){f.globalCompositeOperation="source-over"}else{if(aA===THREE.AdditiveBlending){f.globalCompositeOperation="lighter"}else{if(aA===THREE.SubtractiveBlending){f.globalCompositeOperation="darker"}else{if(aA===THREE.MultiplyBlending){f.globalCompositeOperation="multiply"}}}}ak=aA}}function G(aA){if(H!==aA){f.lineWidth=aA;H=aA}}function R(aA){if(l!==aA){f.lineCap=aA;l=aA}}function ar(aA){if(ah!==aA){f.lineJoin=aA;ah=aA}}function al(aA){if(u!==aA){f.strokeStyle=aA;u=aA}}function Y(aA){if(aj!==aA){f.fillStyle=aA;aj=aA}}function O(aA){if(K.length!==aA.length){f.setLineDash(aA);K=aA}}};